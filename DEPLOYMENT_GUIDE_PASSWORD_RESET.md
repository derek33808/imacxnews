# å¯†ç é‡ç½®åŠŸèƒ½éƒ¨ç½²æŒ‡å—

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. æ•°æ®åº“è¿ç§»

æ‰§è¡Œä»¥ä¸‹SQLè„šæœ¬åˆ›å»ºå¯†ç é‡ç½®ä»¤ç‰Œè¡¨ï¼š

```bash
# æ–¹æ³•1: ä½¿ç”¨Prismaï¼ˆæ¨èï¼‰
npx prisma db push

# æ–¹æ³•2: æ‰‹åŠ¨æ‰§è¡ŒSQLæ–‡ä»¶
psql -h your-host -U your-username -d your-database -f add-password-reset-tokens.sql
```

### 2. ç¯å¢ƒå˜é‡é…ç½®

ç¡®ä¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```env
# æ›´æ–°é‚®ä»¶å‘é€è€…ä¸ºservice@imacxnews.com
RESEND_FROM_EMAIL="service@imacxnews.com"
RESEND_FROM_NAME="IMACX News"
RESEND_API_KEY="your-resend-api-key"

# ç¡®ä¿å…¶ä»–å¿…éœ€çš„ç¯å¢ƒå˜é‡
DATABASE_URL="your-database-url"
JWT_SECRET="your-jwt-secret"
```

### 3. åŸŸåå’Œé‚®ä»¶æœåŠ¡é…ç½®

åœ¨ Resend æ§åˆ¶å°ä¸­ï¼š

1. **æ·»åŠ  service@imacxnews.com**
2. **éªŒè¯åŸŸåé…ç½®**
3. **æµ‹è¯•é‚®ä»¶å‘é€åŠŸèƒ½**

### 4. æ–‡ä»¶éƒ¨ç½²æ¸…å•

ç¡®ä¿ä»¥ä¸‹æ–°æ–‡ä»¶å·²éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼š

```
âœ… src/lib/password-reset.ts
âœ… src/pages/api/auth/forgot-password.ts  
âœ… src/pages/api/auth/verify-reset-password.ts
âœ… src/pages/auth/forgot-password.astro
âœ… src/pages/auth/reset-password.astro
âœ… prisma/schema.prisma (å·²æ›´æ–°)
âœ… src/lib/email.ts (å·²æ›´æ–°)
```

## ğŸ§ª æµ‹è¯•æŒ‡å—

### 1. APIæµ‹è¯•

**æµ‹è¯•å¯†ç é‡ç½®è¯·æ±‚ï¼š**
```bash
curl -X POST https://yourdomain.com/api/auth/forgot-password \
  -H "Content-Type: application/json" \
  -d '{"email": "test@example.com"}'
```

**é¢„æœŸå“åº”ï¼š**
```json
{
  "success": true,
  "message": "If this email is registered, you will receive a password reset link shortly."
}
```

### 2. é¡µé¢æµ‹è¯•

1. **è®¿é—®å¿˜è®°å¯†ç é¡µé¢ï¼š** `https://yourdomain.com/auth/forgot-password`
2. **è¾“å…¥æœ‰æ•ˆé‚®ç®±åœ°å€**
3. **æ£€æŸ¥é‚®ç®±æ˜¯å¦æ”¶åˆ°é‡ç½®é‚®ä»¶**
4. **ç‚¹å‡»é‚®ä»¶ä¸­çš„é‡ç½®é“¾æ¥**
5. **æµ‹è¯•å¯†ç é‡ç½®é¡µé¢åŠŸèƒ½**

### 3. é‚®ä»¶æµ‹è¯•

ä½¿ç”¨ç°æœ‰çš„é‚®ä»¶æµ‹è¯•APIï¼š

```bash
curl -X POST https://yourdomain.com/api/email/test \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "type": "custom",
    "subject": "é‚®ä»¶æœåŠ¡æµ‹è¯•",
    "message": "æ¥è‡ªservice@imacxnews.comçš„æµ‹è¯•é‚®ä»¶"
  }'
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. é‚®ä»¶å‘é€å¤±è´¥
```
é”™è¯¯ï¼šé‚®ä»¶å‘é€å¤±è´¥
è§£å†³ï¼šæ£€æŸ¥RESEND_API_KEYå’ŒåŸŸåéªŒè¯çŠ¶æ€
```

#### 2. æ•°æ®åº“è¿æ¥é”™è¯¯
```
é”™è¯¯ï¼šCan't reach database server
è§£å†³ï¼šæ£€æŸ¥DATABASE_URLé…ç½®å’Œæ•°æ®åº“è¿æ¥
```

#### 3. ä»¤ç‰ŒéªŒè¯å¤±è´¥
```
é”™è¯¯ï¼šInvalid or expired reset token
è§£å†³ï¼šæ£€æŸ¥ä»¤ç‰Œæ˜¯å¦è¿‡æœŸï¼ˆ1å°æ—¶ï¼‰æˆ–å·²ä½¿ç”¨
```

### è°ƒè¯•å‘½ä»¤

```bash
# æ£€æŸ¥Prismaè¿æ¥
npx prisma studio

# æŸ¥çœ‹æ•°æ®åº“è¡¨
npx prisma db seed

# æµ‹è¯•é‚®ä»¶é…ç½®
curl -X GET https://yourdomain.com/api/email/test
```

## ğŸ“Š ç›‘æ§å»ºè®®

### 1. å…³é”®æŒ‡æ ‡ç›‘æ§

- ğŸ“§ é‚®ä»¶å‘é€æˆåŠŸç‡
- ğŸ”‘ ä»¤ç‰Œç”Ÿæˆå’ŒéªŒè¯é¢‘ç‡
- â° ä»¤ç‰Œè¿‡æœŸå’Œæ¸…ç†ç»Ÿè®¡
- ğŸš« å¤±è´¥çš„é‡ç½®å°è¯•æ¬¡æ•°

### 2. æ—¥å¿—ç›‘æ§

å…³æ³¨ä»¥ä¸‹æ—¥å¿—æ¶ˆæ¯ï¼š
```
ğŸ”‘ Password reset token created for user X
ğŸ”„ Password reset successful for user Y
âŒ Invalid password reset token attempt
ğŸ§¹ Cleaned up X expired tokens
```

### 3. å®‰å…¨ç›‘æ§

- ç›‘æ§çŸ­æ—¶é—´å†…å¤§é‡é‡ç½®è¯·æ±‚
- æ£€æŸ¥å¯ç–‘çš„ä»¤ç‰ŒéªŒè¯æ¨¡å¼
- è·Ÿè¸ªé‡ç½®é‚®ä»¶å‘é€é¢‘ç‡

## ğŸ›¡ï¸ å®‰å…¨æ£€æŸ¥æ¸…å•

- âœ… ä»¤ç‰Œé‡‡ç”¨å®‰å…¨éšæœºç”Ÿæˆ
- âœ… æ•°æ®åº“ä¸­å­˜å‚¨å“ˆå¸Œå€¼è€ŒéåŸå§‹ä»¤ç‰Œ
- âœ… ä»¤ç‰Œæœ‰è¿‡æœŸæœºåˆ¶ï¼ˆ1å°æ—¶ï¼‰
- âœ… é˜²æ­¢é‚®ç®±æšä¸¾æ”»å‡»
- âœ… è‡ªåŠ¨æ¸…ç†è¿‡æœŸä»¤ç‰Œ
- âœ… è¯¦ç»†çš„å®‰å…¨æ—¥å¿—è®°å½•

## ğŸ“‹ ä¸Šçº¿åéªŒè¯

### 1. åŠŸèƒ½éªŒè¯
- [ ] ç”¨æˆ·æ³¨å†Œé‚®ä»¶æ­£å¸¸å‘é€
- [ ] å¯†ç é‡ç½®æµç¨‹å®Œæ•´å¯ç”¨
- [ ] é‚®ä»¶æ¨¡æ¿æ˜¾ç¤ºæ­£å¸¸
- [ ] æ‰€æœ‰é¡µé¢å“åº”å¼è®¾è®¡å·¥ä½œæ­£å¸¸

### 2. æ€§èƒ½éªŒè¯
- [ ] APIå“åº”æ—¶é—´åˆç†ï¼ˆ< 2ç§’ï¼‰
- [ ] é‚®ä»¶å‘é€ä¸é˜»å¡ç”¨æˆ·æ“ä½œ
- [ ] æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½è‰¯å¥½

### 3. å®‰å…¨éªŒè¯
- [ ] ä»¤ç‰Œæ— æ³•è¢«çŒœæµ‹æˆ–æš´åŠ›ç ´è§£
- [ ] è¿‡æœŸä»¤ç‰Œæ— æ³•ä½¿ç”¨
- [ ] å·²ä½¿ç”¨ä»¤ç‰Œæ— æ³•é‡å¤ä½¿ç”¨

## ğŸ”„ ç»´æŠ¤ä»»åŠ¡

### æ¯æ—¥ä»»åŠ¡
- æ£€æŸ¥é‚®ä»¶å‘é€çŠ¶æ€
- ç›‘æ§ç³»ç»Ÿé”™è¯¯æ—¥å¿—

### æ¯å‘¨ä»»åŠ¡
- åˆ†æç”¨æˆ·é‡ç½®å¯†ç ä½¿ç”¨æƒ…å†µ
- æ¸…ç†æ•°æ®åº“ä¸­çš„è¿‡æœŸä»¤ç‰Œè®°å½•

### æ¯æœˆä»»åŠ¡
- å®¡æŸ¥å¯†ç é‡ç½®å®‰å…¨æ—¥å¿—
- è¯„ä¼°ç³»ç»Ÿæ€§èƒ½å’Œä¼˜åŒ–éœ€æ±‚

---

## âœ… éƒ¨ç½²å®Œæˆç¡®è®¤

å®Œæˆéƒ¨ç½²åï¼Œè¯·ç¡®è®¤ï¼š

1. âœ… æ•°æ®åº“è¿ç§»æˆåŠŸæ‰§è¡Œ
2. âœ… ç¯å¢ƒå˜é‡æ­£ç¡®é…ç½®
3. âœ… service@imacxnews.com é‚®ç®±éªŒè¯é€šè¿‡
4. âœ… æ‰€æœ‰APIç«¯ç‚¹æ­£å¸¸å“åº”
5. âœ… å‰ç«¯é¡µé¢åŠŸèƒ½æ­£å¸¸
6. âœ… é‚®ä»¶å‘é€æµ‹è¯•æˆåŠŸ
7. âœ… å®Œæ•´çš„å¯†ç é‡ç½®æµç¨‹æµ‹è¯•é€šè¿‡

ğŸ‰ æ­å–œï¼æ‚¨çš„å¯†ç é‡ç½®åŠŸèƒ½å·²æˆåŠŸéƒ¨ç½²ï¼

